---
title: CDN绕过&全网扫描&反向邮件
published: 2025-10-09
description: Web应用CDN绕过及扫描案例。
tags: [Web,信息打点]
category: 网络安全
draft: false
---

## 前置知识

传统访问：用户访问域名–>解析服务器IP–>访问目标主机

普通CDN：用户访问域名–>CDN节点–>真实服务器IP–>访问目标主机

带WAF的CDN：用户访问域名–>CDN节点（WAF）–>真实服务器IP–>访问目标主机

### 国内服务器厂商

阿里云——百度云——七牛云

又拍云——腾讯云——Ucloud

360——网宿科技——ChinaCache

### 国外服务厂商

CloudFlare——StackPath——Fastly

Akamai——CloudFront——Edgecast

CDNetworks——Google Cloud CDN

CacheFly——Keycdn——Udomain——CDN77

## CDN绕过-配置差异导致

1. 使用aliyun创建CDN服务

2. 加速域名->需要启动加速的域名

   子域名获取真实ip 失效（和加速配置有关），如果配置了CDN加速那么设置**www加速**的情况下：

   www.attackor7.tech 加速

   bbs.attackor7.tech或者其他开头 不加速

3. 加速区域->需要启动加速的地区

   国外访问获取真实ip，是基于配置选择加速区域的时候没有勾选全球服务，导致可以找到一些冷门的国外服务器；对该网站进行访问来测试该网站是否有CDN服务，从而来找到真实IP。

## CDN绕过-前置后置-识别&判定访问

**CDN绕过十种方法：**

> 1. 子域名：某些企业业务线较多，有些站点的主站或者部分域名使用了CDN加速，但是一些子域名并未使用加速服务，那么就可以通过子域名获取目标的真实IP。
> 2. 利用网站漏洞：利用网站的漏洞让目标服务器去访问我们自己设置的资源，因为是目标主动出来访问，所以很大概率获取的是真实IP。
> 3. 历史DNS记录：在目标域名还没有使用DNS的时候，有可能通过历史记录会查询到真实IP。
> 4. CDN本身入手：得到控制面板的账号密码，从而获取IP就容易许多。
> 5. 邮件服务查询：站点一般都存在发送邮件的功能，一般邮件都是在内部，也有经过CDN解析，可能在邮件的源码里就包含服务器的真实IP。
> 6. 国外请求：如果域名配置DNS加速区域时，没有配置国外或存在没配置的区域，那么可以在国外或者没配置的区域里访问域名，这样不会受到CDN加速服务的干扰同时可以访问到真实的IP。
> 7. 探测扫描：利用fuckcdn工具
> 8. 需要找 xiaix.me 网站的真实 IP，我们首先从 apnic 获取 IP 段，然后使用 Zmap 的 banner-grab 扫描出来 80 端口开放的主机进行 banner 抓取，最后在 http-req 中的 Host 写 xiaix.me。
> 9. 网络空间引擎搜索法：常见的有以前的钟馗之眼，shodan，fofa。以fofa为例，只需输入：title:“网站的title关键字”或者body：“网站的body特征”就可以找出fofa收录的有这些关键字的ip域名，很多时候能获取网站的真实ip。
> 10. 访问phpinfo.php：当服务器存在某种漏洞时，例如：文件上传，XSS等，可以利用漏洞去访问phpinfo.php文件，在下面会发现IP地址。通过百度查看IP地址是否是本地局域网，如果是区域网则证明目标有多个网卡获取的是内网IP，如果不是则成功发现真实IP。因为是通过内部文件发现的IP，所以属于反向链接。（该方法适用于没有内网网卡的服务器）

**CDN绕过识别工具：**

> 超级Ping：http://www.17ce.com/
>
> 超级Ping：https://ping.chinaz.com/
>
> 接口查询：https://get-site-ip.com/
>
> 接口查询：https://fofa.info/extensions/source
>
> 国外请求：https://tools.ipip.net/cdn.php
>
> 国外请求：https://boce.aliyun.com/detect/
>
> IP社区库：https://www.cz88.net/geo-public
>
> 全网扫描：https://github.com/Tai7sy/fuckcdn
>
> 全网扫描：https://github.com/boy-hack/w8fuckcdn
>
> 全网扫描：https://github.com/Pluto-123/Bypass_cdn

**查找是否存在遗留文件（看运气）：**

在网址后面加上/phpinfo.php查看php信息。

使用页面查找输入SERVER_ADDR，该网页中的信息可能会遗留服务器的IP信息，如果有内网会显示内网IP地址，如果没有内网会显示真实IP地址。

## CDN绕过案例1

利用网站漏洞：

该方法利用的网站的ssrf漏洞，利用服务器存在的ssrf漏洞去访问我们设置好的资源，因为是服务器内部向外部访问，所以获取IP为真实IP。

SSRF漏洞简单介绍：ssrf(服务器端请求伪造)是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。攻击目标通常是从外网无妨访问到内部系统的服务器。正是因为是由服务器发起的，所以它能够请求到与它相连而与外网隔离的内部系统。ssrf漏洞可以利用服务器去加载网上的图片，那么该案例就可以利用ssrf漏洞去访问我们自己的服务器。

因为没有找到合适的靶场以及存在漏洞的学习站所以暂时没有演示。

实际步骤其实也就是开放自己的一个端口用来监听，之后利用ssrf的漏洞访问开放的IP:端口号，之后提交时候就会回显目标服务器对我们进行访问时的IP即为真实IP。

## CDN绕过案例2

该案例是使用真实存在的网站：https://www.huatu.com/

通过超级ping返回的信息可以发现此网站同一个域名的情况下，不同地区访问的IP也是不一样的，所以证明该网站才在CDN。

![](https://cdn.jsdelivr.net/gh/PWN022/0x00@main/NetSecurity/My_screenshot/16-01.png)

在设置cdn时，如果加速域名设置了www.xxx.com，那么只会有该域名进行加速。如果设置的为*.xxx.com，那么所有xxx.com的域名无论开头是什么都会进行加速。

同时可以猜想一下，当访问百度时www.baidu.com与baidu.com是同一个页面，证明baidu.com是www.baidu.com的子域名。

在这里我们可以通过二级域名挖掘工具，对该站进行子域名的一个查询，之后使用超级ping去ping 该站的一些子域名可以发现所有的IP都相同，那么证明它的子域名不存在cdn同时获取了真实IP。

下图1为其中一个子域名：download.huatu.com，图2为app.huatu.com，可以发现这两个子域名都没有经过cdn加速。

![](https://cdn.jsdelivr.net/gh/PWN022/0x00@main/NetSecurity/My_screenshot/16-03.png)

![](https://cdn.jsdelivr.net/gh/PWN022/0x00@main/NetSecurity/My_screenshot/16-04.png)

## CDN绕过-邮件系统&全网扫描

### 邮件系统

判断条件：发信人是当前域名邮件用户名。

- 让他主动给你发:

  部署架设的邮件服务器如果向外部用户发送邮件的话，那么邮件头部的源码中会包含此邮件服务器的真实IP地址。

- 主动给对方发：（需要自己搭建邮件服务器）

  通过发送邮件给一个不存在的邮箱地址，因为该用户邮箱不存在，所以发送将失败并且还会收到一个包含发送该电子邮件给你的服务器的真实IP通知。

常见的邮件触发点有：

- RSS订阅
- 邮箱注册、激活处
- 邮箱找回密码处
- 产品更新的邮件推送
- 某业务执行后发送的邮件通知
- 员工邮箱、邮件管理平台等入口处的忘记密码

### 全网扫描

没有找到合适的站进行演示一般就不放图了，但是具体步骤还是会贴出来。

详细见：https://blog.csdn.net/hello_wprld/article/details/152009345

1. 判断加速厂商
2. IP库筛选地址段
3. 配置范围扫描

先从IP段去扫描符合开放端口，再从IP去访问查看关键字，一般抓取title中的某些字段保存为关键字，将符合结果进行保存。

#### 小知识：什么叫扫c段

A类网络号占1个字节，范围1-126，也就是8位；B类占2字节，范围128-191，16位。C类占3字节，范围192-223。子网掩码分别为255.0.0.0、255.255.0.0、255.255.255.0，24位。

扫c段具体过程（这里就不放图演示了）：

打开nmap输入想要扫描的ip的字段，比如47.122.10.0/24（47.122.10.1-47.122.10.255），之后找到你想要的服务端口是开放状态的IP地址（比如需要http服务，也就是80端口），最后进行IP反查域名。

